// Copyright 2022 Google LLC
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     https://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

        .intel_syntax noprefix
        .code64
        .text
        .globl show_flag
show_flag:
        sub rsp, 8
        mov rbx, rsp
        movq [rbx], offset .L32
        mov eax, 0x23
        mov [rbx+4], eax
        ljmp [rbx]

        .code32
.L32:
        mov ecx, 0 /* O_RDONLY */
        lea ebx, [.str_flag]
        mov eax, 5 /* __NR_open */
        int 0x80
        mov edx, 50
        lea ecx, [scratch]
        mov ebx, eax
        mov eax, 3 /* __NR_read */
        int 0x80
        mov edx, eax
        lea ecx, [scratch]
        mov ebx, 1  /* stdout */
        mov eax, 4  /* __NR_write */
        int 0x80
        mov ebx, 0  /* exit_code */
        mov eax, 1  /* __NR_exit */
        int 0x80

.str_flag: .asciz "flag"

        .data
scratch:  .space 50
