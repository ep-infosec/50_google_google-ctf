doit: LDFLAGS=-static
doit: doit.o
doit.o: shellcode.h

shellcode: shellcode.o
	ld -s shellcode.o -o shellcode

shellcode.o: shellcode.asm
	nasm -f elf64 shellcode.asm

shellcode.h: shellcode
	python -c 'open("shellcode.h", "w").write("const char sc[] = \""+"".join(map(lambda c: "\\x{:02x}".format(ord(c)), open("shellcode").read()))+"\";")'
