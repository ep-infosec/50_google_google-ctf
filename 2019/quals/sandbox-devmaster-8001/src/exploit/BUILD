cc_binary(
    name = "better_client",
    srcs = ["better_client.cc"],
    deps = ["//:client_lib"],
    copts = ["-fexceptions"],
    features = ["-use_header_modules"],
    linkopts = ["-pthread"],
    linkstatic = 1,
)

cc_binary(
    name = "drop_privs",
    srcs = ["drop_privs.cc"],
    copts = ["-fexceptions"],
    features = ["-use_header_modules"],
    linkopts = ["-pthread"],
    linkstatic = 1,
)


cc_binary(
    name = "drop_privs_specific",
    srcs = ["drop_privs_specific.cc"],
    copts = ["-fexceptions"],
    features = ["-use_header_modules"],
    linkopts = ["-pthread"],
    linkstatic = 1,
)

cc_library(
    name = "ptrace_do",
    srcs = ["ptrace_do.cc", "parse_maps.cc"],
    hdrs = ["ptrace_do.h"],
    copts = ["-fexceptions"],
    features = ["-use_header_modules"],
)

cc_binary(
    name = "main_hacked",
    srcs = ["main_hacked.cc"],
    copts = ["-fexceptions"],
    features = ["-use_header_modules"],
    linkopts = ["-pthread"],
    linkstatic = 1,
)

cc_binary(
    name = "injector",
    srcs = ["injector.cc"],
    copts = ["-fexceptions"],
    features = ["-use_header_modules"],
    linkopts = ["-pthread"],
    linkstatic = 1,
    deps = [":ptrace_do"],
)

genrule(
    name = "exploit",
    srcs = ["exploit.sh"],
    cmd = "cat $(location exploit.sh) > $(location exploit); chmod +x $(location exploit)",
    outs = ["exploit"],
    output_to_bindir=True,
)

cc_binary(
    name = "run_exploit",
    srcs = ["run_exploit.cc"],
    copts = ["-fexceptions"],
    features = ["-use_header_modules"],
    linkopts = ["-pthread"],
    linkstatic = 1,
    deps = ["//third_party:subprocess"],
)

genrule(
    name = "main_hacked_b64",
    srcs = [],
    cmd = "base64 $(location main_hacked) > $(location main_hacked_b64)",
    outs = ["main_hacked_b64"],
    tools = [":main_hacked"],
    output_to_bindir=True,
)

